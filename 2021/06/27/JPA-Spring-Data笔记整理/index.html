<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"bdr54321.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="JPA&amp;Spring Data笔记整理 来自尚硅谷的谷粒商城视频整理">
<meta property="og:type" content="article">
<meta property="og:title" content="JPA&amp;Spring Data笔记整理">
<meta property="og:url" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/index.html">
<meta property="og:site_name" content="知识管理">
<meta property="og:description" content="JPA&amp;Spring Data笔记整理 来自尚硅谷的谷粒商城视频整理">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625141952518.png">
<meta property="og:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625142410350.png">
<meta property="og:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625150906869.png">
<meta property="og:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625152114289.png">
<meta property="og:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625161039941.png">
<meta property="og:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625164534391.png">
<meta property="og:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625202745850.png">
<meta property="og:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625202823920.png">
<meta property="og:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210626131551793.png">
<meta property="og:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210626131616402.png">
<meta property="og:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210626135311053.png">
<meta property="og:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210626140727153.png">
<meta property="og:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210626141302329.png">
<meta property="article:published_time" content="2021-06-27T07:53:20.000Z">
<meta property="article:modified_time" content="2021-06-28T09:45:43.534Z">
<meta property="article:author" content="daren bi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625141952518.png">

<link rel="canonical" href="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>JPA&Spring Data笔记整理 | 知识管理</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">知识管理</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://bdr54321.github.io/2021/06/27/JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="daren bi">
      <meta itemprop="description" content="真正牛逼的，不是那些可以随口拿来夸耀的事迹，而是那些在困境中依然保持微笑的凡人 --程浩">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知识管理">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          JPA&Spring Data笔记整理
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-27 15:53:20" itemprop="dateCreated datePublished" datetime="2021-06-27T15:53:20+08:00">2021-06-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-28 17:45:43" itemprop="dateModified" datetime="2021-06-28T17:45:43+08:00">2021-06-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1>JPA&amp;Spring Data笔记整理</h1>
<p>来自尚硅谷的谷粒商城视频整理</p>
<span id="more"></span>
<h2 id="JPA">JPA</h2>
<h3 id="JPA-概述">JPA_概述</h3>
<ul>
<li>JDBC框架</li>
</ul>
<p><img src="JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625141952518.png" alt="image-20210625141952518"></p>
<h4 id="JPA-是什么">JPA 是什么</h4>
<ul>
<li>
<p>Java Persistence API：用于对象持久化的 API</p>
</li>
<li>
<p>Java EE 5.0 平台标准的 ORM 规范，使得应用程序以统一的方式访问持久层</p>
<p><img src="JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625142410350.png" alt="image-20210625142410350"></p>
</li>
</ul>
<h4 id="JPA和Hibernate的关系">JPA和Hibernate的关系</h4>
<ul>
<li>
<p>JPA 是 hibernate 的一个抽象（就像JDBC和JDBC驱动的关系）：</p>
<ul>
<li>
<p><strong>JPA</strong> <strong>是规范</strong>：JPA 本质上就是一种 ORM 规范，不是ORM 框架 —— 因为 JPA 并未提供 ORM 实现，它只是制订了一些规范，提供了一些编程的 API 接口，但具体实现则由 ORM 厂商提供实现</p>
</li>
<li>
<p><strong>Hibernate</strong> <strong>是实现</strong>：Hibernate 除了作为 ORM 框架之外，它也是一种 JPA 实现</p>
</li>
</ul>
</li>
<li>
<p>•从功能上来说， <strong>JPA</strong> <strong>是</strong> <strong>Hibernate</strong> <strong>功能****的一个子集</strong></p>
</li>
</ul>
<h4 id="JPA的优势">JPA的优势</h4>
<ul>
<li>
<p><strong>标准化</strong>: 提供相同的 API，这保证了基于JPA 开发的企业应用能够经过少量的修改就能够在不同的 JPA 框架下运行。</p>
</li>
<li>
<p><strong>简单易用，集成方便</strong>: JPA 的主要目标之一就是提供更加简单的编程模型，在 JPA 框架下创建实体和创建 Java 类一样简单，只需要使用 javax.persistence.Entity 进行注释；JPA 的框架和接口也都非常简单，</p>
</li>
<li>
<p><strong>可媲美JDBC的查询</strong>能力: <strong>JPA的查询语言是面向对象的，JPA定义了独特的JPQL</strong>，而且能够支持批量更新和修改、JOIN、GROUP BY、HAVING 等通常只有 SQL 才能够提供的高级查询特性，甚至还能够支持子查询。</p>
</li>
<li>
<p><strong>支持面向对象的高级特性</strong>: JPA 中能够支持面向对象的高级特性，如类之间的继承、多态和类之间的复杂关系，最大限度的使用面向对象的模型</p>
</li>
</ul>
<h3 id="HelloWorld">HelloWorld</h3>
<h4 id="使用JPA持久化对象的步骤">使用JPA持久化对象的步骤</h4>
<ul>
<li>创建 persistence.xml, 在这个文件中配置持久化单元
<ul>
<li>需要指定跟哪个数据库进行交互;</li>
<li>需要指定 JPA 使用哪个持久化的框架以及配置该框架的基本属性</li>
</ul>
</li>
<li>创建实体类, 使用 annotation 来描述实体类跟数据库表之间的映射关系.</li>
<li>使用 JPA API 完成数据增加、删除、修改和查询操作
<ul>
<li>创建 EntityManagerFactory (对应 Hibernate 中的 SessionFactory);</li>
<li>创建 EntityManager (对应 Hibernate 中的Session);</li>
</ul>
</li>
</ul>
<h4 id="代码相关">代码相关</h4>
<p>配置文件：persistence.xml(<strong>JPA 规范要求在类路径的 META-INF 目录下放置persistence.xml，文件的名称是固定的</strong>)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">            配置使用什么 ORM 产品来作为 JPA 的实现 </span></span><br><span class="line"><span class="comment">            1. 实际上配置的是  javax.persistence.spi.PersistenceProvider 接口的实现类</span></span><br><span class="line"><span class="comment">            2. 若 JPA 项目中只有一个 JPA 的实现产品, 则也可以不配置该节点. </span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">provider</span>&gt;</span>org.hibernate.ejb.HibernatePersistence<span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">			<span class="comment">&lt;!-- 连接数据库的基本信息 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///jpa&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1230&quot;</span>/&gt;</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">&lt;!-- 配置 JPA 实现产品的基本属性. 配置 hibernate 的基本属性 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.format_sql&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.show_sql&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    		<span class="comment">&lt;!-- 生成数据表策略 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.hbm2ddl.auto&quot;</span> <span class="attr">value</span>=<span class="string">&quot;update&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">		    <span class="comment">&lt;!-- 添加持久化类 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">class</span>&gt;</span>com.atguigu.jpa.helloworld.Customer<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>持久化类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table(name=&quot;JPA_CUTOMERS&quot;)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Date createdTime;</span><br><span class="line">	<span class="keyword">private</span> Date birth;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GeneratedValue(strategy=GenerationType.AUTO)</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name=&quot;LAST_NAME&quot;,length=50,nullable=false)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> lastName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastName</span><span class="params">(String lastName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Temporal(TemporalType.TIMESTAMP)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getCreatedTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> createdTime;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreatedTime</span><span class="params">(Date createdTime)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.createdTime = createdTime;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Temporal(TemporalType.DATE)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getBirth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> birth;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirth</span><span class="params">(Date birth)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.birth = birth;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 创建 EntitymanagerFactory</span></span><br><span class="line">String persistenceUnitName = <span class="string">&quot;jpa-1&quot;</span>;</span><br><span class="line">EntityManagerFactory entityManagerFactory = </span><br><span class="line">    Persistence.createEntityManagerFactory(persistenceUnitName);</span><br><span class="line"><span class="comment">//2. 创建 EntityManager. 类似于 Hibernate 的 SessionFactory</span></span><br><span class="line">EntityManager entityManager = entityManagerFactory.createEntityManager();</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 开启事务</span></span><br><span class="line">EntityTransaction transaction = entityManager.getTransaction();</span><br><span class="line">transaction.begin();</span><br><span class="line"></span><br><span class="line"><span class="comment">//4. 进行持久化操作</span></span><br><span class="line">Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">customer.setAge(<span class="number">12</span>);</span><br><span class="line">customer.setEmail(<span class="string">&quot;tom@atguigu.com&quot;</span>);</span><br><span class="line">customer.setLastName(<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">customer.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">customer.setCreatedTime(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">entityManager.persist(customer);</span><br><span class="line"></span><br><span class="line"><span class="comment">//5. 提交事务</span></span><br><span class="line">transaction.commit();</span><br><span class="line"></span><br><span class="line"><span class="comment">//6. 关闭 EntityManager</span></span><br><span class="line">entityManager.close();</span><br><span class="line"></span><br><span class="line"><span class="comment">//7. 关闭 EntityManagerFactory</span></span><br><span class="line">entityManagerFactory.close();		</span><br></pre></td></tr></table></figure>
<h3 id="JPA-基本注解">JPA 基本注解</h3>
<ul>
<li>
<p><strong>@Entity</strong>:标注用于实体类声明语句之前，<strong>指出该****Java</strong> <strong>类****为实体类</strong>，<strong>将映射到指定的数据库表</strong>。如声明一个实体类 Customer，它将映射到数据库中的 customer 表上。</p>
</li>
<li>
<p><strong>@Table</strong>:•标注的常用选项是 <strong>name</strong>，用于指明数据库的表名</p>
</li>
<li>
<p><strong>@Id</strong>:</p>
<ul>
<li>@Id用于声明一个实体类的属性映射为数据库的<strong>主键列</strong>。该属性通常置于属性声明语句之前，可与声明语句同行，也可写在单独行上。</li>
<li>@Id标注也可置于属性的getter方法之前。</li>
</ul>
</li>
</ul>
<p><img src="JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625150906869.png" alt="image-20210625150906869"></p>
<ul>
<li>
<p><strong>@GeneratedValue</strong>:用于标注主键的生成策略，通过 strategy 属性指定。默认情况下，JPA 自动选择一个最适合底层数据库的主键生成策略</p>
<ul>
<li>IDENTITY：采用数据库 ID自增长的方式来自增主键字段，Oracle 不支持这种方式；</li>
<li>AUTO： JPA自动选择合适的策略，是默认选项；</li>
<li>SEQUENCE：通过序列产生主键，通过 @SequenceGenerator 注解指定序列名，MySql 不支持这种方式</li>
<li>TABLE：通过表产生主键，框架借由表模拟序列产生主键，使用该策略可以使应用更易于数据库移植。</li>
</ul>
</li>
<li>
<p>@Basic:表示一个简单的属性到数据库表的字段的映射,对于没有任何标注的 getXxxx() 方法,默认即为@Basic。</p>
<ul>
<li>fetch: 表示该属性的读取策略,有 EAGER 和 LAZY 两种,分别表示主支抓取和延迟加载,默认为 EAGER.</li>
<li>optional:表示该属性是否允许为null, 默认为true</li>
</ul>
</li>
<li>
<p>@Column：</p>
</li>
</ul>
<h3 id="Transient注解"><strong>@Transient</strong>注解</h3>
<ul>
<li>
<p>表示该属性并非一个到数据库表的字段的映射,ORM框架将忽略该属性.</p>
</li>
<li>
<p>如果一个属性并非数据库表的字段映射,就务必将其标示为@Transient,否则,ORM框架默认其注解为@Basic</p>
</li>
</ul>
<h3 id="Temporal">**@**Temporal</h3>
<ul>
<li>
<p>在核心的 Java API 中并没有定义 Date 类型的精度(temporal precision).  而在数据库中,表示 Date 类型的数据有 DATE, TIME, 和 TIMESTAMP 三种精度(即单纯的日期,时间,或者两者 兼备). 在进行属性映射时可使用@Temporal注解来调整精度.</p>
</li>
<li>
<p>mysql的5种日期类型</p>
<p><img src="JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625152114289.png" alt="image-20210625152114289"></p>
</li>
<li>
<p>代码示例</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Customer类定义中截取</span></span><br><span class="line"><span class="meta">@Temporal(TemporalType.TIMESTAMP)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getCreatedTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> createdTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreatedTime</span><span class="params">(Date createdTime)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.createdTime = createdTime;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//数据库中会变成datetime类型</span></span><br><span class="line"><span class="meta">@Temporal(TemporalType.DATE)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getBirth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> birth;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//数据库中会变成date类型</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirth</span><span class="params">(Date birth)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.birth = birth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="用-table-来生成主键详解">用 table 来生成主键详解</h3>
<h3 id="JPA-EntityManager-1">JPA_EntityManager(1)</h3>
<h4 id="Persistence">Persistence</h4>
<ul>
<li>
<p>Persistence 类是<strong>用于获取 EntityManagerFactory 实例</strong>。该类包含一个名为 createEntityManagerFactory 的 静态方法 。</p>
</li>
<li>
<p>createEntityManagerFactory 方法有如下两个重载版本。</p>
<ul>
<li>带有一个参数的方法以 JPA 配置文件 persistence.xml 中的持久化单元名为参数</li>
<li>带有两个参数的方法：前一个参数含义相同，后一个参数 Map类型，用于设置 JPA 的相关属性，这时将忽略其它地方设置的属性。Map 对象的属性名必须是 JPA 实现库提供商的名字空间约定的属性名。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 创建 EntitymanagerFactory</span></span><br><span class="line">String persistenceUnitName = <span class="string">&quot;jpa-1&quot;</span>;</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; properites = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">properites.put(<span class="string">&quot;hibernate.show_sql&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">EntityManagerFactory entityManagerFactory = </span><br><span class="line">    <span class="comment">//Persistence.createEntityManagerFactory(persistenceUnitName);</span></span><br><span class="line">    Persistence.createEntityManagerFactory(persistenceUnitName, properites);</span><br></pre></td></tr></table></figure>
<h4 id="EntityManagerFactory">EntityManagerFactory</h4>
<ul>
<li>EntityManagerFactory 接口主要用来创建 EntityManager 实例。该接口约定了如下4个方法：
<ul>
<li><strong>createEntityManager()</strong>：用于创建实体管理器对象实例。</li>
<li>createEntityManager(Map map)：用于创建实体管理器对象实例的重载方法，Map 参数用于提供 EntityManager 的属性。</li>
<li>isOpen()：检查 EntityManagerFactory 是否处于打开状态。实体管理器工厂创建后一直处于打开状态，除非调用close()方法将其关闭。</li>
<li><strong>close()</strong>：关闭 EntityManagerFactory 。 EntityManagerFactory 关闭后将释放所有资源，isOpen()方法测试将返回 false，其它方法将不能调用，否则将导致IllegalStateException异常。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2. 创建 EntityManager. 类似于 Hibernate 的 SessionFactory</span></span><br><span class="line">EntityManager entityManager = entityManagerFactory.createEntityManager();</span><br><span class="line"></span><br><span class="line"><span class="comment">//7. 关闭 EntityManagerFactory</span></span><br><span class="line">entityManagerFactory.close();</span><br></pre></td></tr></table></figure>
<h3 id="JPA-EntityManager-2">JPA_EntityManager(2)</h3>
<ul>
<li>首先搭建测试环境</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JPATest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> EntityManagerFactory entityManagerFactory;</span><br><span class="line">	<span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line">	<span class="keyword">private</span> EntityTransaction transaction;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">		entityManagerFactory = Persistence.createEntityManagerFactory(<span class="string">&quot;jpa-1&quot;</span>);</span><br><span class="line">		entityManager = entityManagerFactory.createEntityManager();</span><br><span class="line">		transaction = entityManager.getTransaction();</span><br><span class="line">		transaction.begin();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@After</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>&#123;</span><br><span class="line">		transaction.commit();</span><br><span class="line">		entityManager.close();</span><br><span class="line">		entityManagerFactory.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="find方法">find方法</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类似于 hibernate 中 Session 的 get 方法. </span></span><br><span class="line"><span class="comment">//find方法会立即发送select语句</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFind</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Customer customer = entityManager.find(Customer.class, <span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;-------------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(customer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="getReference方法">getReference方法</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类似于 hibernate 中 Session 的 load 方法，</span></span><br><span class="line"><span class="comment">//先返回一个代理对象，在真正使用时在发送select语句</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetReference</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = entityManager.getReference(Customer.class, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//会打印一个代理对象</span></span><br><span class="line">    System.out.println(customer.getClass().getName());</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;-------------------------------------&quot;</span>);</span><br><span class="line">    <span class="comment">//把下面两行的注释取消，会出现软加载异常的问题。因为此时的代理对象不再受到entityManager的管理，也就无法发送select语句</span></span><br><span class="line">    <span class="comment">//		transaction.commit();</span></span><br><span class="line">    <span class="comment">//		entityManager.close();</span></span><br><span class="line"></span><br><span class="line">    System.out.println(customer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="persist方法"><strong>persist</strong>方法</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类似于 hibernate 的 save 方法. 使对象由临时状态变为持久化状态. </span></span><br><span class="line"><span class="comment">//和 hibernate 的 save 方法的不同之处: 若对象有 id, 则不能执行 insert 操作, 而会抛出异常. 而hibernate不会</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPersistence</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setAge(<span class="number">15</span>);</span><br><span class="line">    customer.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setCreatedTime(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setEmail(<span class="string">&quot;bb@163.com&quot;</span>);</span><br><span class="line">    customer.setLastName(<span class="string">&quot;BB&quot;</span>);</span><br><span class="line">    <span class="comment">//若对象有 id, 则不能执行 insert 操作, 而会抛出异常.</span></span><br><span class="line">	<span class="comment">//customer.setId(100); </span></span><br><span class="line">    entityManager.persist(customer);</span><br><span class="line">    System.out.println(customer.getId());<span class="comment">//打印id，使对象由临时状态变为持久化状态</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="remove方法">remove方法</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类似于 hibernate 中 Session 的 delete 方法. 把对象对应的记录从数据库中移除</span></span><br><span class="line"><span class="comment">//但注意: 该方法只能移除 持久化 对象. 而 hibernate 的 delete 方法实际上还可以移除 游离对象.</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRemove</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//此时创建了一个游离对象，但不能删除</span></span><br><span class="line">    <span class="comment">//	Customer customer = new Customer();</span></span><br><span class="line">    <span class="comment">//	customer.setId(2);</span></span><br><span class="line"></span><br><span class="line">    Customer customer = entityManager.find(Customer.class, <span class="number">2</span>);</span><br><span class="line">    entityManager.remove(customer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="jpa角度下对象分为四种状态">jpa角度下对象分为四种状态</h4>
<p><strong>新建状态</strong>:   新创建的对象，尚未拥有持久性主键。<br>
<strong>持久化状态</strong>：已经【拥有持久性主键】（数据库中有该对象）并和持久化【建立了上下文环境】（受到entityManager管理）<br>
<strong>游离状态</strong>：拥有持久化主键，但是没有与持久化建立上下文环境<br>
<strong>删除状态</strong>:  拥有持久化主键，已经和持久化建立上下文环境，但是从数据库中删除。</p>
<h3 id="JPA-EntityManager-3-–merge方法">JPA_EntityManager(3)–merge方法</h3>
<ul>
<li>merge方法：用于处理 Entity 的同步。即数据库的插入和更新操作</li>
</ul>
<p><img src="JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625161039941.png" alt="image-20210625161039941"></p>
<ul>
<li>情况一（共有4种）：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 总的来说: 类似于 hibernate Session 的 saveOrUpdate 方法.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//1. 若传入的是一个临时对象</span></span><br><span class="line"><span class="comment">//会创建一个新的对象, 把临时对象的属性复制到新的对象中, 然后对新的对象执行持久化操作. 所以</span></span><br><span class="line"><span class="comment">//新的对象中有 id, 但以前的临时对象中没有 id. </span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMerge1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setAge(<span class="number">18</span>);</span><br><span class="line">    customer.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setCreatedTime(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setEmail(<span class="string">&quot;cc@163.com&quot;</span>);</span><br><span class="line">    customer.setLastName(<span class="string">&quot;CC&quot;</span>);</span><br><span class="line">	<span class="comment">//这里会对customer2发送一个insert语句</span></span><br><span class="line">    Customer customer2 = entityManager.merge(customer);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;customer#id:&quot;</span> + customer.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;customer2#id:&quot;</span> + customer2.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>情况二</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//若传入的是一个游离对象, 即传入的对象有 OID. </span></span><br><span class="line"><span class="comment">//1. 若在 EntityManager 缓存中没有该对象</span></span><br><span class="line"><span class="comment">//2. 若在数据库中也没有对应的记录</span></span><br><span class="line"><span class="comment">//3. JPA 会创建一个新的对象, 然后把当前游离对象的属性复制到新创建的对象中</span></span><br><span class="line"><span class="comment">//4. 对新创建的对象执行 insert 操作. </span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMerge2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setAge(<span class="number">18</span>);</span><br><span class="line">    customer.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setCreatedTime(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setEmail(<span class="string">&quot;dd@163.com&quot;</span>);</span><br><span class="line">    customer.setLastName(<span class="string">&quot;DD&quot;</span>);</span><br><span class="line"></span><br><span class="line">    customer.setId(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    Customer customer2 = entityManager.merge(customer);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;customer#id:&quot;</span> + customer.getId());</span><br><span class="line">    System.out.println(<span class="string">&quot;customer2#id:&quot;</span> + customer2.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>情况三</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//若传入的是一个游离对象, 即传入的对象有 OID. </span></span><br><span class="line"><span class="comment">//1. 若在 EntityManager 缓存中没有该对象</span></span><br><span class="line"><span class="comment">//2. 若在数据库中也有对应的记录</span></span><br><span class="line"><span class="comment">//3. JPA 会查询对应的记录, 然后返回该记录对一个的对象, 再然后会把游离对象的属性复制到查询到的对象中.</span></span><br><span class="line"><span class="comment">//4. 对查询到的对象执行 update 操作. </span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMerge3</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setAge(<span class="number">18</span>);</span><br><span class="line">    customer.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setCreatedTime(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setEmail(<span class="string">&quot;ee@163.com&quot;</span>);</span><br><span class="line">    customer.setLastName(<span class="string">&quot;EE&quot;</span>);</span><br><span class="line"></span><br><span class="line">    customer.setId(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    Customer customer2 = entityManager.merge(customer);</span><br><span class="line"></span><br><span class="line">    System.out.println(customer == customer2); <span class="comment">//false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>情况四</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//若传入的是一个游离对象, 即传入的对象有 OID. </span></span><br><span class="line"><span class="comment">//1. 若在 EntityManager 缓存中有对应的对象</span></span><br><span class="line"><span class="comment">//2. JPA 会把游离对象的属性复制到查询到EntityManager 缓存中的对象中.</span></span><br><span class="line"><span class="comment">//3. EntityManager 缓存中的对象执行 UPDATE. </span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMerge4</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setAge(<span class="number">18</span>);</span><br><span class="line">    customer.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setCreatedTime(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setEmail(<span class="string">&quot;dd@163.com&quot;</span>);</span><br><span class="line">    customer.setLastName(<span class="string">&quot;DD&quot;</span>);</span><br><span class="line"></span><br><span class="line">    customer.setId(<span class="number">4</span>);</span><br><span class="line">    Customer customer2 = entityManager.find(Customer.class, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    entityManager.merge(customer);</span><br><span class="line"></span><br><span class="line">    System.out.println(customer == customer2); <span class="comment">//false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JPA-EntityManager-4">JPA_EntityManager(4)</h3>
<h4 id="flush方法">flush方法</h4>
<p>强制发送sql语句，使数据表中的记录和内存中的对象一致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 同 hibernate 中 Session 的 flush 方法. </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFlush</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = entityManager.find(Customer.class, <span class="number">1</span>);</span><br><span class="line">    System.out.println(customer);</span><br><span class="line"></span><br><span class="line">    customer.setLastName(<span class="string">&quot;AA&quot;</span>);</span><br><span class="line">	<span class="comment">//强制发送update语句，否则，该语句会在提交事务的时候再发送</span></span><br><span class="line">    entityManager.flush();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="refresh方法">refresh方法</h4>
<p>用数据库实体记录的值更新实体对象的状态，即更新实例的属性值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 同 hibernate 中 Session 的 refresh 方法. </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRefresh</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = entityManager.find(Customer.class, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//由于一级缓存的存在，只会发送一条sql</span></span><br><span class="line">    customer = entityManager.find(Customer.class, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//重新获取一下数据库中的记录，看是不是还是和内存中的一样，也就是会发送一条select语句</span></span><br><span class="line">    entityManager.refresh(customer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="clear方法">clear方法</h4>
<p>清除持久上下文环境，断开所有关联的实体。如果这时还有未提交的更新则会被撤消。</p>
<h3 id="JPA-EntityTransaction">JPA_EntityTransaction</h3>
<ul>
<li>
<p>EntityTransaction 接口用来管理资源层实体管理器的事务操作。</p>
</li>
<li>
<p>通过调用实体管理器的getTransaction方法 获得其实例。</p>
</li>
<li>
<p>API</p>
</li>
</ul>
<p><img src="JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625164534391.png" alt="image-20210625164534391"></p>
<h3 id="JPA-映射单向多对一的关联关系">JPA_映射单向多对一的关联关系</h3>
<ul>
<li>Order对象（多）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table(name=&quot;JPA_ORDERS&quot;)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String orderName;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Customer customer;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Column(name=&quot;ORDER_NAME&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getOrderName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> orderName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderName</span><span class="params">(String orderName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.orderName = orderName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//映射单向 n-1 的关联关系</span></span><br><span class="line">	<span class="comment">//使用 @ManyToOne 来映射多对一的关联关系</span></span><br><span class="line">	<span class="comment">//使用 @JoinColumn 来映射外键. </span></span><br><span class="line">	<span class="comment">//可使用 @ManyToOne 的 fetch 属性来修改默认的关联属性的加载策略</span></span><br><span class="line">	<span class="meta">@JoinColumn(name=&quot;CUSTOMER_ID&quot;)</span></span><br><span class="line">	<span class="meta">@ManyToOne(fetch=FetchType.LAZY)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Customer <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> customer;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.customer = customer;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>Customer（一）</li>
</ul>
<p>注：类定义中不用加</p>
<blockquote>
<p>private Set<Order> orders = new HashSet&lt;&gt;();</p>
</blockquote>
<ul>
<li>代码示例</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存多对一时, 建议先保存 1 的一端, 后保存 n 的一端, 这样不会多出额外的 UPDATE 语句.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testManyToOnePersist</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setAge(<span class="number">18</span>);</span><br><span class="line">    customer.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setCreatedTime(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setEmail(<span class="string">&quot;gg@163.com&quot;</span>);</span><br><span class="line">    customer.setLastName(<span class="string">&quot;GG&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Order order1 = <span class="keyword">new</span> Order();</span><br><span class="line">    order1.setOrderName(<span class="string">&quot;G-GG-1&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Order order2 = <span class="keyword">new</span> Order();</span><br><span class="line">    order2.setOrderName(<span class="string">&quot;G-GG-2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置关联关系</span></span><br><span class="line">    order1.setCustomer(customer);</span><br><span class="line">    order2.setCustomer(customer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行保存操作</span></span><br><span class="line">    entityManager.persist(order1);</span><br><span class="line">    entityManager.persist(order2);</span><br><span class="line"></span><br><span class="line">    entityManager.persist(customer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//默认情况下, 使用左外连接的方式来获取 n 的一端的对象和其关联的 1 的一端的对象. </span></span><br><span class="line"><span class="comment">//可使用 @ManyToOne 的 fetch 属性来修改默认的关联属性的加载策略</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testManyToOneFind</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Order order = entityManager.find(Order.class, <span class="number">1</span>);</span><br><span class="line">    System.out.println(order.getOrderName());</span><br><span class="line"></span><br><span class="line">    System.out.println(order.getCustomer().getLastName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//不能直接删除 1 的一端,会报异常，因为有外键约束. </span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testManyToOneRemove</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//		Order order = entityManager.find(Order.class, 1);</span></span><br><span class="line">    <span class="comment">//		entityManager.remove(order);</span></span><br><span class="line"></span><br><span class="line">    Customer customer = entityManager.find(Customer.class, <span class="number">7</span>);</span><br><span class="line">    entityManager.remove(customer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testManyToOneUpdate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Order order = entityManager.find(Order.class, <span class="number">2</span>);</span><br><span class="line">    order.getCustomer().setLastName(<span class="string">&quot;FFF&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JPA-映射单向一对多的关联关系">JPA_映射单向一对多的关联关系</h3>
<ul>
<li>将Order类中的customer属性删除；在Customer中添加private Set<Order> orders = new HashSet&lt;&gt;();</li>
</ul>
<p>Customer中的修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//映射单向 1-n 的关联关系</span></span><br><span class="line"><span class="comment">//使用 @OneToMany 来映射 1-n 的关联关系</span></span><br><span class="line"><span class="comment">//使用 @JoinColumn 来映射外键列的名称，该外键列仍然会显示在order表中</span></span><br><span class="line"><span class="comment">//可以使用 @OneToMany 的 fetch 属性来修改默认的加载策略</span></span><br><span class="line"><span class="comment">//可以通过 @OneToMany 的 cascade 属性来修改默认的删除策略. </span></span><br><span class="line"><span class="comment">//注意: 若在 1 的一端的 @OneToMany 中使用 mappedBy 属性, 则 @OneToMany 端就不能再使用 @JoinColumn 属性了. </span></span><br><span class="line"><span class="meta">@JoinColumn(name=&quot;CUSTOMER_ID&quot;)</span></span><br><span class="line"><span class="meta">@OneToMany(fetch=FetchType.LAZY,cascade=&#123;CascadeType.REMOVE&#125;,mappedBy=&quot;customer&quot;)</span><span class="comment">//CascadeType.REMOVE:级联删除</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;Order&gt; <span class="title">getOrders</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> orders;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrders</span><span class="params">(Set&lt;Order&gt; orders)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.orders = orders;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单向 1-n 关联关系执行保存时, 一定会多出 UPDATE 语句(因为order不再维护关联关系，则order在insert时不会再设置外键列，在update时才会设置外键列).</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneToManyPersist</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setAge(<span class="number">18</span>);</span><br><span class="line">    customer.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setCreatedTime(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setEmail(<span class="string">&quot;mm@163.com&quot;</span>);</span><br><span class="line">    customer.setLastName(<span class="string">&quot;MM&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Order order1 = <span class="keyword">new</span> Order();</span><br><span class="line">    order1.setOrderName(<span class="string">&quot;O-MM-1&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Order order2 = <span class="keyword">new</span> Order();</span><br><span class="line">    order2.setOrderName(<span class="string">&quot;O-MM-2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//建立关联关系</span></span><br><span class="line">    customer.getOrders().add(order1);</span><br><span class="line">    customer.getOrders().add(order2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行保存操作</span></span><br><span class="line">    entityManager.persist(customer);</span><br><span class="line"></span><br><span class="line">    entityManager.persist(order1);</span><br><span class="line">    entityManager.persist(order2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//默认对关联的多的一方使用懒加载的加载策略. </span></span><br><span class="line"><span class="comment">//可以使用 @OneToMany 的 fetch 属性来修改默认的加载策略</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneToManyFind</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = entityManager.find(Customer.class, <span class="number">9</span>);</span><br><span class="line">    System.out.println(customer.getLastName());</span><br><span class="line"></span><br><span class="line">    System.out.println(customer.getOrders().size());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//默认情况下, 若删除 1 的一端, 则会先把关联的 n 的一端的外键置空, 然后进行删除. </span></span><br><span class="line"><span class="comment">//可以通过 @OneToMany 的 cascade 属性来修改默认的删除策略. </span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneToManyRemove</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = entityManager.find(Customer.class, <span class="number">8</span>);</span><br><span class="line">    entityManager.remove(customer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = entityManager.find(Customer.class, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    customer.getOrders().iterator().next().setOrderName(<span class="string">&quot;O-XXX-10&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JPA-映射双向一对多的关联关系">JPA_映射双向一对多的关联关系</h3>
<p>Customer类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table(name=&quot;JPA_CUTOMERS&quot;)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Date createdTime;</span><br><span class="line">	<span class="keyword">private</span> Date birth;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(String lastName, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Set&lt;Order&gt; orders = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//	@TableGenerator(name=&quot;ID_GENERATOR&quot;,</span></span><br><span class="line"><span class="comment">//			table=&quot;jpa_id_generators&quot;,</span></span><br><span class="line"><span class="comment">//			pkColumnName=&quot;PK_NAME&quot;,</span></span><br><span class="line"><span class="comment">//			pkColumnValue=&quot;CUSTOMER_ID&quot;,</span></span><br><span class="line"><span class="comment">//			valueColumnName=&quot;PK_VALUE&quot;,</span></span><br><span class="line"><span class="comment">//			allocationSize=100)</span></span><br><span class="line"><span class="comment">//	@GeneratedValue(strategy=GenerationType.TABLE,generator=&quot;ID_GENERATOR&quot;)</span></span><br><span class="line">	<span class="meta">@GeneratedValue(strategy=GenerationType.AUTO)</span></span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Column(name=&quot;LAST_NAME&quot;,length=50,nullable=false)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> lastName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastName</span><span class="params">(String lastName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> email;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Temporal(TemporalType.TIMESTAMP)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getCreatedTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> createdTime;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreatedTime</span><span class="params">(Date createdTime)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.createdTime = createdTime;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Temporal(TemporalType.DATE)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getBirth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> birth;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirth</span><span class="params">(Date birth)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.birth = birth;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//映射单向 1-n 的关联关系</span></span><br><span class="line">	<span class="comment">//使用 @OneToMany 来映射 1-n 的关联关系</span></span><br><span class="line">	<span class="comment">//使用 @JoinColumn 来映射外键列的名称</span></span><br><span class="line">	<span class="comment">//可以使用 @OneToMany 的 fetch 属性来修改默认的加载策略</span></span><br><span class="line">	<span class="comment">//可以通过 @OneToMany 的 cascade 属性来修改默认的删除策略. </span></span><br><span class="line">	<span class="comment">//注意: 若在 1 的一端的 @OneToMany 中使用 mappedBy 属性, 则 @OneToMany 端就不能再使用 @JoinColumn 属性了. </span></span><br><span class="line"><span class="comment">//	@JoinColumn(name=&quot;CUSTOMER_ID&quot;)</span></span><br><span class="line">	<span class="meta">@OneToMany(fetch=FetchType.LAZY,cascade=&#123;CascadeType.REMOVE&#125;,mappedBy=&quot;customer&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Set&lt;Order&gt; <span class="title">getOrders</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> orders;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrders</span><span class="params">(Set&lt;Order&gt; orders)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.orders = orders;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Customer [id=&quot;</span> + id + <span class="string">&quot;, lastName=&quot;</span> + lastName + <span class="string">&quot;, email=&quot;</span></span><br><span class="line">				+ email + <span class="string">&quot;, age=&quot;</span> + age + <span class="string">&quot;, createdTime=&quot;</span> + createdTime</span><br><span class="line">				+ <span class="string">&quot;, birth=&quot;</span> + birth + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Order类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table(name=&quot;JPA_ORDERS&quot;)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String orderName;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Customer customer;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Column(name=&quot;ORDER_NAME&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getOrderName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> orderName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderName</span><span class="params">(String orderName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.orderName = orderName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//映射单向 n-1 的关联关系</span></span><br><span class="line">	<span class="comment">//使用 @ManyToOne 来映射多对一的关联关系</span></span><br><span class="line">	<span class="comment">//使用 @JoinColumn 来映射外键. </span></span><br><span class="line">	<span class="comment">//可使用 @ManyToOne 的 fetch 属性来修改默认的关联属性的加载策略</span></span><br><span class="line">	<span class="meta">@JoinColumn(name=&quot;CUSTOMER_ID&quot;)</span></span><br><span class="line">	<span class="meta">@ManyToOne(fetch=FetchType.LAZY)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Customer <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> customer;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.customer = customer;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>代码示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//若是双向 1-n 的关联关系, 执行保存时</span></span><br><span class="line"><span class="comment">//若先保存 n 的一端, 再保存 1 的一端, 默认情况下, 会多出 4 条 UPDATE 语句(另外多出来的两条是因为Customer也要维护关联关系).</span></span><br><span class="line"><span class="comment">//若先保存 1 的一端, 则会多出 2 条 UPDATE 语句</span></span><br><span class="line"><span class="comment">//在进行双向 1-n 关联关系时, 建议使用 n 的一方来维护关联关系, 而 1 的一方不维护关联系, 这样会有效的减少 SQL 语句. </span></span><br><span class="line"><span class="comment">//注意: 若在 1 的一端的 @OneToMany 中使用 mappedBy 属性（表示1的一端放弃维护关联关系）, 则 @OneToMany 端就不能再使用 @JoinColumn 属性了. </span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneToManyPersist</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setAge(<span class="number">18</span>);</span><br><span class="line">    customer.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setCreatedTime(<span class="keyword">new</span> Date());</span><br><span class="line">    customer.setEmail(<span class="string">&quot;mm@163.com&quot;</span>);</span><br><span class="line">    customer.setLastName(<span class="string">&quot;MM&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Order order1 = <span class="keyword">new</span> Order();</span><br><span class="line">    order1.setOrderName(<span class="string">&quot;O-MM-1&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Order order2 = <span class="keyword">new</span> Order();</span><br><span class="line">    order2.setOrderName(<span class="string">&quot;O-MM-2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//建立关联关系</span></span><br><span class="line">    customer.getOrders().add(order1);</span><br><span class="line">    customer.getOrders().add(order2);</span><br><span class="line"></span><br><span class="line">    order1.setCustomer(customer);</span><br><span class="line">    order2.setCustomer(customer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行保存操作</span></span><br><span class="line">    entityManager.persist(customer);</span><br><span class="line"></span><br><span class="line">    entityManager.persist(order1);</span><br><span class="line">    entityManager.persist(order2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JPA-映射双向一对一的关联关系">JPA_映射双向一对一的关联关系</h3>
<p>建两个类，部门和经理，一个部门只能有一个经理，一个经理只能管一个部门</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table(name=&quot;JPA_DEPARTMENTS&quot;)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String deptName;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Manager mgr;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Column(name=&quot;DEPT_NAME&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDeptName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> deptName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDeptName</span><span class="params">(String deptName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.deptName = deptName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用 @OneToOne 来映射 1-1 关联关系。</span></span><br><span class="line">	<span class="comment">//若需要在当前数据表中添加主键则需要使用 @JoinColumn 来进行映射. 注意, 1-1 关联关系, 所以需要添加 unique=true</span></span><br><span class="line">	<span class="meta">@JoinColumn(name=&quot;MGR_ID&quot;, unique=true)</span></span><br><span class="line">	<span class="meta">@OneToOne(fetch=FetchType.LAZY)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Manager <span class="title">getMgr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mgr;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMgr</span><span class="params">(Manager mgr)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mgr = mgr;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Table(name=&quot;JPA_MANAGERS&quot;)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Manager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String mgrName;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Department dept;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Column(name=&quot;MGR_NAME&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getMgrName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mgrName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMgrName</span><span class="params">(String mgrName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mgrName = mgrName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//对于不维护关联关系, 没有外键的一方, 使用 @OneToOne 来进行映射, 建议设置 mappedBy=true</span></span><br><span class="line">	<span class="meta">@OneToOne(mappedBy=&quot;mgr&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Department <span class="title">getDept</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dept;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDept</span><span class="params">(Department dept)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.dept = dept;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>代码示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//双向 1-1 的关联关系, 建议先保存不维护关联关系的一方, 即没有外键的一方, 这样不会多出 UPDATE 语句.</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneToOnePersistence</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Manager mgr = <span class="keyword">new</span> Manager();</span><br><span class="line">    mgr.setMgrName(<span class="string">&quot;M-BB&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Department dept = <span class="keyword">new</span> Department();</span><br><span class="line">    dept.setDeptName(<span class="string">&quot;D-BB&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置关联关系</span></span><br><span class="line">    mgr.setDept(dept);</span><br><span class="line">    dept.setMgr(mgr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行保存操作</span></span><br><span class="line">    entityManager.persist(mgr);</span><br><span class="line">    entityManager.persist(dept);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.默认情况下, 若获取维护关联关系的一方, 则会通过左外连接获取其关联的对象. </span></span><br><span class="line"><span class="comment">//但可以通过 @OntToOne 的 fetch 属性来修改加载策略(会减少一条select语句).</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneToOneFind</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Department dept = entityManager.find(Department.class, <span class="number">1</span>);</span><br><span class="line">    System.out.println(dept.getDeptName());</span><br><span class="line">    System.out.println(dept.getMgr().getClass().getName());<span class="comment">//此时得到的Manager是一个代理类</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1. 默认情况下, 若获取不维护关联关系的一方, 则也会通过左外连接获取其关联的对象. </span></span><br><span class="line"><span class="comment">//可以通过 @OneToOne 的 fetch 属性来修改加载策略. 但依然会再发送 SQL 语句来初始化其关联的对象</span></span><br><span class="line"><span class="comment">//这说明在不维护关联关系的一方, 不建议修改 fetch 属性.</span></span><br><span class="line"><span class="comment">//因为Manager没有外键，他必须要先查另一张表来获取信息</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneToOneFind2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Manager mgr = entityManager.find(Manager.class, <span class="number">1</span>);</span><br><span class="line">    System.out.println(mgr.getMgrName());</span><br><span class="line"></span><br><span class="line">    System.out.println(mgr.getDept().getClass().getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="JPA-映射双向多对多的关联关系">JPA_映射双向多对多的关联关系</h3>
<h3 id="JPA-二级缓存">JPA_二级缓存</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果利用的是一级缓存，会发送两条sql语句</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSecondLevelCache</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Customer customer1 = entityManager.find(Customer.class, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    transaction.commit();</span><br><span class="line">    entityManager.close();</span><br><span class="line"></span><br><span class="line">    entityManager = entityManagerFactory.createEntityManager();</span><br><span class="line">    transaction = entityManager.getTransaction();</span><br><span class="line">    transaction.begin();</span><br><span class="line"></span><br><span class="line">    Customer customer2 = entityManager.find(Customer.class, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>persistence.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">  配置二级缓存的策略 </span></span><br><span class="line"><span class="comment">  ALL：所有的实体类都被缓存</span></span><br><span class="line"><span class="comment">  NONE：所有的实体类都不被缓存. </span></span><br><span class="line"><span class="comment">  ENABLE_SELECTIVE：标识 @Cacheable(true) 注解的实体类将被缓存</span></span><br><span class="line"><span class="comment">  DISABLE_SELECTIVE：缓存除标识 @Cacheable(false) 以外的所有实体类</span></span><br><span class="line"><span class="comment">  UNSPECIFIED：默认值，JPA 产品默认值将被使用</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shared-cache-mode</span>&gt;</span>ENABLE_SELECTIVE<span class="tag">&lt;/<span class="name">shared-cache-mode</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 二级缓存相关 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启用二级缓存 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.cache.use_second_level_cache&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 二级缓存的产品（需要xml文件） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.cache.region.factory_class&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.hibernate.cache.ehcache.EhCacheRegionFactory&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 查询缓存 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.cache.use_query_cache&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span>	</span><br></pre></td></tr></table></figure>
<blockquote>
<p><shared-cache-mode>ENABLE_SELECTIVE</shared-cache-mode></p>
</blockquote>
<p><strong>ENABLE_SELECTIVE：标识 @Cacheable(true) 注解的实体类将被缓存</strong></p>
<h3 id="JPA-JPQL-HelloWorld">JPA_JPQL_HelloWorld</h3>
<ul>
<li>
<p><strong>JPQL语言，即 Java Persistence Query Language 的简称</strong>。JPQL 是一种和 SQL 非常类似的中间性和对象化查询语言，它最终会被编译成针对不同底层数据库的 SQL 查询，从而屏蔽不同数据库的差异。</p>
</li>
<li>
<p>JPQL语言的语句可以是 <strong>select 语句、update 语句或delete语句</strong>，它们都通过 Query 接口封装执行</p>
</li>
<li>
<p><strong>Query接口</strong>封装了执行数据库查询的相关方法。调用 EntityManager 的 createQuery、create NamedQuery 及 createNativeQuery 方法可以获得查询对象，进而可调用 Query 接口的相关方法来执行查询操作。</p>
</li>
</ul>
<p><img src="JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625202745850.png" alt="image-20210625202745850"></p>
<p><img src="JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210625202823920.png" alt="image-20210625202823920"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHelloJPQL</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String jpql = <span class="string">&quot;FROM Customer c WHERE c.age &gt; ?&quot;</span>;</span><br><span class="line">    Query query = entityManager.createQuery(jpql);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//占位符的索引是从 1 开始</span></span><br><span class="line">    query.setParameter(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    List&lt;Customer&gt; customers = query.getResultList();</span><br><span class="line">    System.out.println(customers.size());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//默认情况下, 若只查询部分属性, 则将返回 Object[] 类型的结果. 或者 Object[] 类型的 List.</span></span><br><span class="line"><span class="comment">//也可以在实体类中创建对应的构造器, 然后再 JPQL 语句中利用对应的构造器返回实体类的对象.</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPartlyProperties</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String jpql = <span class="string">&quot;SELECT new Customer(c.lastName, c.age) FROM Customer c WHERE c.id &gt; ?&quot;</span>;</span><br><span class="line">    List result = entityManager.createQuery(jpql).setParameter(<span class="number">1</span>, <span class="number">1</span>).getResultList();</span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//createNamedQuery 适用于在实体类前使用 @NamedQuery 标记的查询语句</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNamedQuery</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Query query = entityManager.createNamedQuery(<span class="string">&quot;testNamedQuery&quot;</span>).setParameter(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">    Customer customer = (Customer) query.getSingleResult();</span><br><span class="line"></span><br><span class="line">    System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//createNativeQuery 适用于本地 SQL</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNativeQuery</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String sql = <span class="string">&quot;SELECT age FROM jpa_cutomers WHERE id = ?&quot;</span>;</span><br><span class="line">    Query query = entityManager.createNativeQuery(sql).setParameter(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    Object result = query.getSingleResult();</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JPA-JPQL-查询缓存">JPA_JPQL_查询缓存</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认情况下是两条sql，使用 hibernate 的查询缓存可以只用一条sql. </span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryCache</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String jpql = <span class="string">&quot;FROM Customer c WHERE c.age &gt; ?&quot;</span>;</span><br><span class="line">    <span class="comment">//使用查询缓存</span></span><br><span class="line">    Query query = entityManager.createQuery(jpql).setHint(QueryHints.HINT_CACHEABLE, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//占位符的索引是从 1 开始</span></span><br><span class="line">    query.setParameter(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    List&lt;Customer&gt; customers = query.getResultList();</span><br><span class="line">    System.out.println(customers.size());</span><br><span class="line"></span><br><span class="line">    query = entityManager.createQuery(jpql).setHint(QueryHints.HINT_CACHEABLE, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//占位符的索引是从 1 开始</span></span><br><span class="line">    query.setParameter(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    customers = query.getResultList();</span><br><span class="line">    System.out.println(customers.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JPA-JPQL-ORDERBY和GROUPBY">JPA_JPQL_ORDERBY和GROUPBY</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOrderBy</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String jpql = <span class="string">&quot;FROM Customer c WHERE c.age &gt; ? ORDER BY c.age DESC&quot;</span>;</span><br><span class="line">    Query query = entityManager.createQuery(jpql).setHint(QueryHints.HINT_CACHEABLE, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//占位符的索引是从 1 开始</span></span><br><span class="line">    query.setParameter(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    List&lt;Customer&gt; customers = query.getResultList();</span><br><span class="line">    System.out.println(customers.size());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询 order 数量大于 2 的那些 Customer</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGroupBy</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String jpql = <span class="string">&quot;SELECT o.customer FROM Order o &quot;</span></span><br><span class="line">        + <span class="string">&quot;GROUP BY o.customer &quot;</span></span><br><span class="line">        + <span class="string">&quot;HAVING count(o.id) &gt;= 2&quot;</span>;</span><br><span class="line">    List&lt;Customer&gt; customers = entityManager.createQuery(jpql).getResultList();</span><br><span class="line"></span><br><span class="line">    System.out.println(customers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JPA-JPQL-关联查询">JPA_JPQL_关联查询</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JPQL 的关联查询同 HQL 的关联查询. </span></span><br><span class="line"><span class="comment"> * fetch的作用是：使得查询结果返回的是一个Customer和Order组成的对象，而不是一个Object[]数组。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLeftOuterJoinFetch</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String jpql = <span class="string">&quot;FROM Customer c LEFT OUTER JOIN FETCH c.orders WHERE c.id = ?&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Customer customer = </span><br><span class="line">        (Customer) entityManager.createQuery(jpql).setParameter(<span class="number">1</span>, <span class="number">12</span>).getSingleResult();</span><br><span class="line">    System.out.println(customer.getLastName());</span><br><span class="line">    System.out.println(customer.getOrders().size());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//		List&lt;Object[]&gt; result = entityManager.createQuery(jpql).setParameter(1, 12).getResultList();</span></span><br><span class="line">    <span class="comment">//		System.out.println(result);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JPQL-子查询和内建函数">JPQL_子查询和内建函数</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSubQuery</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//查询所有 Customer 的 lastName 为 YY 的 Order</span></span><br><span class="line">    String jpql = <span class="string">&quot;SELECT o FROM Order o &quot;</span></span><br><span class="line">        + <span class="string">&quot;WHERE o.customer = (SELECT c FROM Customer c WHERE c.lastName = ?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Query query = entityManager.createQuery(jpql).setParameter(<span class="number">1</span>, <span class="string">&quot;YY&quot;</span>);</span><br><span class="line">    List&lt;Order&gt; orders = query.getResultList();</span><br><span class="line">    System.out.println(orders.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJpqlFunction</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String jpql = <span class="string">&quot;SELECT lower(c.email) FROM Customer c&quot;</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; emails = entityManager.createQuery(jpql).getResultList();</span><br><span class="line">    System.out.println(emails);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JPA-JPQL-DELETE和UPDATE">JPA_JPQL_DELETE和UPDATE</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以使用 JPQL 完成 UPDATE 和 DELETE 操作. </span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testExecuteUpdate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String jpql = <span class="string">&quot;UPDATE Customer c SET c.lastName = ? WHERE c.id = ?&quot;</span>;</span><br><span class="line">    Query query = entityManager.createQuery(jpql).setParameter(<span class="number">1</span>, <span class="string">&quot;YYY&quot;</span>).setParameter(<span class="number">2</span>, <span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">    query.executeUpdate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JPA-整合Spring">JPA_整合Spring</h3>
<ul>
<li>三种整合方式
<ul>
<li>LocalEntityManagerFactoryBean：适用于那些仅使用 JPA 进行数据访问的项目，该 FactoryBean 将根据JPA PersistenceProvider 自动检测配置文件进行工作，一般从“META-INF/persistence.xml”读取配置信息，这种方式最简单，<strong>但不能设置 Spring 中定义的DataSource，且不支持 Spring 管理的全局事务</strong></li>
<li>从JNDI中获取：<strong>用于从 Java EE 服务器获取指定的EntityManagerFactory</strong>，这种方式在进行 Spring 事务管理时一般要使用 JTA 事务管理</li>
<li><strong>LocalContainerEntityManagerFactoryBean</strong>(建议使用)：适用于所有环境的 FactoryBean，能全面控制 EntityManagerFactory 配置,如指定 Spring 定义的 DataSource 等等。</li>
</ul>
</li>
</ul>
<h2 id="Spring-Data">Spring Data</h2>
<h3 id="概述">概述</h3>
<ul>
<li>Spring 的一个子项目。用于简化数据库访问，<strong>支持NoSQL 和 关系数据存储</strong>。其【主要目标】是使【数据库的访问变得方便快捷】。</li>
<li>JPA Spring Data 概述
<ul>
<li>致力于减少数据访问层 (DAO) 的开发量. 开发者唯一要做的，就只是声明持久层的接口，其他都交给 Spring Data JPA 来帮你完成！</li>
<li>框架怎么可能代替开发者实现业务逻辑呢？比如：当有一个 UserDao.findUserById()  这样一个方法声明，大致应该能判断出这是根据给定条件的 ID 查询出满足条件的 User  对象。Spring Data JPA 做的便是规范方法的名字，根据符合规范的名字来确定方法需要实现什么样的逻辑。</li>
</ul>
</li>
</ul>
<h3 id="HelloWorld-2">HelloWorld</h3>
<ul>
<li>使用 Spring Data JPA 进行持久层开发需要的四个步骤：
<ul>
<li><strong>配置 Spring 整合 JPA</strong></li>
<li>**在 Spring 配置文件中配置 Spring Data，让 Spring 为声明的接口创建代理对象。**配置了 <a href="jpa:repositories">jpa:repositories</a> 后，Spring 初始化容器时将会扫描 base-package  指定的包目录及其子目录，为继承 Repository 或其子接口的接口创建代理对象，并将代理对象注册为 Spring Bean，业务层便可以通过 Spring 自动封装的特性来直接使用该对象。</li>
<li><strong>声明持久层的接口</strong>，该接口继承  Repository，Repository 是一个标记型接口，它不包含任何方法，如必要，Spring Data 可实现 Repository 其他子接口，其中定义了一些常用的增删改查，以及分页相关的方法。</li>
<li><strong>在接口中声明需要的方法</strong>。Spring Data 将根据给定的策略（具体策略稍后讲解）来为其生成实现代码。</li>
</ul>
</li>
</ul>
<p>applicationContext.xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1. 配置c3p0数据源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:db.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.user&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span>	</span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClass&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.jdbcUrl&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置其他属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2. 配置 JPA 的 EntityManagerFactory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;entityManagerFactory&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jpaVendorAdapter&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 对应@Entity注解 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;packagesToScan&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.atguigu.springdata&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jpaProperties&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 二级缓存相关 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">    &lt;prop key=&quot;hibernate.cache.region.factory_class&quot;&gt;org.hibernate.cache.ehcache.EhCacheRegionFactory&lt;/prop&gt;</span></span><br><span class="line"><span class="comment">    &lt;prop key=&quot;net.sf.ehcache.configurationResourceName&quot;&gt;ehcache-hibernate.xml&lt;/prop&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 生成的数据表的列的映射策略 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;hibernate.ejb.naming_strategy&quot;</span>&gt;</span>org.hibernate.cfg.ImprovedNamingStrategy<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- hibernate 基本属性 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;hibernate.dialect&quot;</span>&gt;</span>org.hibernate.dialect.MySQL5InnoDBDialect<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;hibernate.show_sql&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;hibernate.format_sql&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;hibernate.hbm2ddl.auto&quot;</span>&gt;</span>update<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 3. 配置事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;entityManagerFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;entityManagerFactory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span>	</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 4. 配置支持注解的事务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 5. 配置 SpringData --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 加入  jpa 的命名空间 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- base-package: 扫描 Repository Bean 所在的 package --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jpa:repositories</span> <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu.springdata&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">entity-manager-factory-ref</span>=<span class="string">&quot;entityManagerFactory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">jpa:repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.user</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">1230</span></span><br><span class="line"><span class="meta">jdbc.driverClass</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.jdbcUrl</span>=<span class="string">jdbc:mysql:///jpa</span></span><br></pre></td></tr></table></figure>
<h4 id="代码测试">代码测试</h4>
<p>实体</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table(name=&quot;JPA_PERSONS&quot;)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> Date birth;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Address address;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer addressId;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> lastName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastName</span><span class="params">(String lastName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> email;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getBirth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> birth;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirth</span><span class="params">(Date birth)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.birth = birth;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Column(name=&quot;ADD_ID&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getAddressId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> addressId;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddressId</span><span class="params">(Integer addressId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.addressId = addressId;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@JoinColumn(name=&quot;ADDRESS_ID&quot;)</span></span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Address <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> address;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(Address address)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.address = address;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Person [id=&quot;</span> + id + <span class="string">&quot;, lastName=&quot;</span> + lastName + <span class="string">&quot;, email=&quot;</span></span><br><span class="line">				+ email + <span class="string">&quot;, brith=&quot;</span> + birth + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>变量初始化（整个课程的测试代码都可以使用）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ApplicationContext ctx = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">private</span> PersonRepsotory personRepsotory = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">private</span> PersonService personService;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    personRepsotory = ctx.getBean(PersonRepsotory.class);</span><br><span class="line">    personService = ctx.getBean(PersonService.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试数据源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    DataSource dataSource = ctx.getBean(DataSource.class);</span><br><span class="line">    System.out.println(dataSource.getConnection());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试JPA的是否配置成功</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先创建一个实体类，再执行这个代码</span></span><br><span class="line"><span class="comment">//执行，应该在数据库中成功建表</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJpa</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试helloworld（包含Spring Data）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonRepsotory</span> <span class="keyword">extends</span> <span class="title">Repository</span>&lt;<span class="title">Person</span>, <span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//根据 lastName 来获取对应的 Person</span></span><br><span class="line">    <span class="function">Person <span class="title">getByLastName</span><span class="params">(String lastName)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHelloWorldSpringData</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException, IOException, InstantiationException, IllegalAccessException</span>&#123;</span><br><span class="line">    System.out.println(personRepsotory.getClass().getName());</span><br><span class="line"></span><br><span class="line">    Person person = personRepsotory.getByLastName(<span class="string">&quot;AA&quot;</span>);</span><br><span class="line">    System.out.println(person);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Repository接口">Repository接口</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. Repository 是一个空接口. 即是一个标记接口</span></span><br><span class="line"><span class="comment"> * 2. 若我们定义的接口继承了 Repository, 则该接口会被 IOC 容器识别为一个 Repository Bean.</span></span><br><span class="line"><span class="comment"> * 纳入到 IOC 容器中. 进而可以在该接口中定义满足一定规范的方法. </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 3. 实际上, 也可以通过 <span class="doctag">@RepositoryDefinition</span> 注解来替代继承 Repository 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//@RepositoryDefinition(domainClass=Person.class,idClass=Integer.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonRepsotory</span> <span class="keyword">extends</span> <span class="title">Repository</span>&lt;<span class="title">Person</span>, <span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//根据 lastName 来获取对应的 Person</span></span><br><span class="line">    <span class="function">Person <span class="title">getByLastName</span><span class="params">(String lastName)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Repository查询方法定义规范">Repository查询方法定义规范</h3>
<ul>
<li>简单条件查询: 查询某一个实体类或者集合</li>
<li>按照 Spring Data 的规范，查询方法以 find | read | get 开头， 涉及条件查询时，条件的属性用条件关键字连接，要注意的是：条件属性以首字母大写。</li>
<li>支持属性的级联查询. <strong>若当前类有符合条件的属性, 则优先使用, 而不使用级联属性。<strong>若需要使用级联属性, 则</strong>属性之间使用 _ 进行连接.</strong></li>
<li>支持的关键字</li>
</ul>
<p><img src="JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210626131551793.png" alt="image-20210626131551793"></p>
<p><img src="JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210626131616402.png" alt="image-20210626131616402"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//WHERE lastName LIKE ?% AND id &lt; ?</span></span><br><span class="line"><span class="function">List&lt;Person&gt; <span class="title">getByLastNameStartingWithAndIdLessThan</span><span class="params">(String lastName, Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//WHERE lastName LIKE %? AND id &lt; ?</span></span><br><span class="line"><span class="function">List&lt;Person&gt; <span class="title">getByLastNameEndingWithAndIdLessThan</span><span class="params">(String lastName, Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//WHERE email IN (?, ?, ?) OR birth &lt; ?</span></span><br><span class="line"><span class="function">List&lt;Person&gt; <span class="title">getByEmailInAndBirthLessThan</span><span class="params">(List&lt;String&gt; emails, Date birth)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//WHERE a.id &gt; ?</span></span><br><span class="line"><span class="function">List&lt;Person&gt; <span class="title">getByAddress_IdGreaterThan</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="Query注解">Query注解</h3>
<ul>
<li>这种查询可以声明在 Repository 方法中，<strong>摆脱像命名查询那样的约束，将查询直接在相应的接口方法中声明</strong>，结构更为清晰，这是 Spring data 的特有实现。</li>
<li>可以实现更复杂的查询，比如子查询</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询 id 值最大的那个 Person</span></span><br><span class="line"><span class="comment">//使用 @Query 注解可以自定义 JPQL 语句以实现更灵活的查询</span></span><br><span class="line"><span class="meta">@Query(&quot;SELECT p FROM Person p WHERE p.id = (SELECT max(p2.id) FROM Person p2)&quot;)</span></span><br><span class="line"><span class="function">Person <span class="title">getMaxIdPerson</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为 @Query 注解传递参数的方式1: 使用占位符. </span></span><br><span class="line"><span class="meta">@Query(&quot;SELECT p FROM Person p WHERE p.lastName = ?1 AND p.email = ?2&quot;)</span></span><br><span class="line"><span class="function">List&lt;Person&gt; <span class="title">testQueryAnnotationParams1</span><span class="params">(String lastName, String email)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为 @Query 注解传递参数的方式1: 命名参数的方式. </span></span><br><span class="line"><span class="meta">@Query(&quot;SELECT p FROM Person p WHERE p.lastName = :lastName AND p.email = :email&quot;)</span></span><br><span class="line"><span class="function">List&lt;Person&gt; <span class="title">testQueryAnnotationParams2</span><span class="params">(<span class="meta">@Param(&quot;email&quot;)</span> String email, <span class="meta">@Param(&quot;lastName&quot;)</span> String lastName)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//SpringData 允许在占位符上添加 %%. </span></span><br><span class="line"><span class="meta">@Query(&quot;SELECT p FROM Person p WHERE p.lastName LIKE %?1% OR p.email LIKE %?2%&quot;)</span></span><br><span class="line"><span class="function">List&lt;Person&gt; <span class="title">testQueryAnnotationLikeParam</span><span class="params">(String lastName, String email)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//SpringData 允许在占位符上添加 %%. </span></span><br><span class="line"><span class="meta">@Query(&quot;SELECT p FROM Person p WHERE p.lastName LIKE %:lastName% OR p.email LIKE %:email%&quot;)</span></span><br><span class="line"><span class="function">List&lt;Person&gt; <span class="title">testQueryAnnotationLikeParam2</span><span class="params">(<span class="meta">@Param(&quot;email&quot;)</span> String email, <span class="meta">@Param(&quot;lastName&quot;)</span> String lastName)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置 nativeQuery=true 即可以使用原生的 SQL 查询</span></span><br><span class="line"><span class="meta">@Query(value=&quot;SELECT count(id) FROM jpa_persons&quot;, nativeQuery=true)</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">getTotalCount</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="Modifying注解">Modifying注解</h3>
<ul>
<li>@Query 与 @Modifying 这两个 annotation一起声明，可定义个性化更新操作</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以通过自定义的 JPQL 完成 UPDATE 和 DELETE 操作. 注意: JPQL 不支持使用 INSERT</span></span><br><span class="line"><span class="comment">//在 @Query 注解中编写 JPQL 语句, 但必须使用 @Modifying 进行修饰. 以通知 SpringData, 这是一个 UPDATE 或 DELETE 操作</span></span><br><span class="line"><span class="comment">//UPDATE 或 DELETE 操作需要使用事务, 此时需要定义 Service 层. 在 Service 层的方法上添加事务操作. </span></span><br><span class="line"><span class="comment">//默认情况下, SpringData 的每个方法上有事务, 但都是一个只读事务. 他们不能完成修改操作!</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Query(&quot;UPDATE Person p SET p.email = :email WHERE id = :id&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updatePersonEmail</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id, <span class="meta">@Param(&quot;email&quot;)</span> String email)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> PersonRepsotory personRepsotory;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Transactional</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePersonEmail</span><span class="params">(String email, Integer id)</span></span>&#123;</span><br><span class="line">		personRepsotory.updatePersonEmail(id, email);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testModifying</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//		personRepsotory.updatePersonEmail(1, &quot;mmmm@atguigu.com&quot;);</span></span><br><span class="line">    personService.updatePersonEmail(<span class="string">&quot;mmmm@atguigu.com&quot;</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="CrudRepository接口">CrudRepository接口</h3>
<ul>
<li>CrudRepository 接口提供了最基本的对实体类的添删改查操作</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonRepsotory</span> <span class="keyword">extends</span> <span class="title">CrudRepository</span>&lt;<span class="title">Person</span>, <span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> PersonRepsotory personRepsotory;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Transactional</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">savePersons</span><span class="params">(List&lt;Person&gt; persons)</span></span>&#123;</span><br><span class="line">        <span class="comment">//CrudRepository 接口的save(Iterable&lt;T&gt;)方法</span></span><br><span class="line">		personRepsotory.save(persons);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCrudReposiory</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;Person&gt; persons = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="string">&#x27;a&#x27;</span>; i &lt;= <span class="string">&#x27;z&#x27;</span>; i++)&#123;</span><br><span class="line">        Person person = <span class="keyword">new</span> Person();</span><br><span class="line">        person.setAddressId(i + <span class="number">1</span>);</span><br><span class="line">        person.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">        person.setEmail((<span class="keyword">char</span>)i + <span class="string">&quot;&quot;</span> + (<span class="keyword">char</span>)i + <span class="string">&quot;@atguigu.com&quot;</span>);</span><br><span class="line">        person.setLastName((<span class="keyword">char</span>)i + <span class="string">&quot;&quot;</span> + (<span class="keyword">char</span>)i);</span><br><span class="line"></span><br><span class="line">        persons.add(person);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    personService.savePersons(persons);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="PagingAndSortingRespository接口">PagingAndSortingRespository接口</h3>
<ul>
<li>该接口提供了分页与排序功能
<ul>
<li>Iterable<T> findAll(Sort sort); //排序</li>
<li><strong>Page<T> findAll(Pageable pageable)</strong>; //分页查询（含排序功能）</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonRepsotory</span> <span class="keyword">extends</span> <span class="title">PagingAndSortingRespository</span>&lt;<span class="title">Person</span>, <span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPagingAndSortingRespository</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//pageNo 从 0 开始. </span></span><br><span class="line">    <span class="comment">//第三页</span></span><br><span class="line">    <span class="keyword">int</span> pageNo = <span class="number">3</span> - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> pageSize = <span class="number">5</span>;</span><br><span class="line">    <span class="comment">//Pageable 接口通常使用的其 PageRequest 实现类. 其中封装了需要分页的信息</span></span><br><span class="line">    <span class="comment">//排序相关的. Sort 封装了排序的信息</span></span><br><span class="line">    <span class="comment">//Order 是具体针对于某一个属性进行升序还是降序. </span></span><br><span class="line">    Order order1 = <span class="keyword">new</span> Order(Direction.DESC, <span class="string">&quot;id&quot;</span>);</span><br><span class="line">    Order order2 = <span class="keyword">new</span> Order(Direction.ASC, <span class="string">&quot;email&quot;</span>);</span><br><span class="line">    Sort sort = <span class="keyword">new</span> Sort(order1, order2);</span><br><span class="line"></span><br><span class="line">    PageRequest pageable = <span class="keyword">new</span> PageRequest(pageNo, pageSize, sort);</span><br><span class="line">    Page&lt;Person&gt; page = personRepsotory.findAll(pageable);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;总记录数: &quot;</span> + page.getTotalElements());</span><br><span class="line">    System.out.println(<span class="string">&quot;当前第几页: &quot;</span> + (page.getNumber() + <span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;总页数: &quot;</span> + page.getTotalPages());</span><br><span class="line">    System.out.println(<span class="string">&quot;当前页面的 List: &quot;</span> + page.getContent());</span><br><span class="line">    System.out.println(<span class="string">&quot;当前页面的记录数: &quot;</span> + page.getNumberOfElements());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210626135311053.png" alt="image-20210626135311053"></p>
<p>注：当前在第三页</p>
<h3 id="JpaRepository接口">JpaRepository接口</h3>
<ul>
<li>该接口提供了JPA的相关功能</li>
</ul>
<p>测试该接口的T saveAndFlush(T entity)方法。该方法相当于jpa的merge方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonRepsotory</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Person</span>, <span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJpaRepository</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Person person = <span class="keyword">new</span> Person();</span><br><span class="line">    person.setBirth(<span class="keyword">new</span> Date());</span><br><span class="line">    person.setEmail(<span class="string">&quot;xy@atguigu.com&quot;</span>);</span><br><span class="line">    person.setLastName(<span class="string">&quot;xyz&quot;</span>);</span><br><span class="line">    person.setId(<span class="number">28</span>);</span><br><span class="line">	<span class="comment">//返回一个代理对象</span></span><br><span class="line">    Person person2 = personRepsotory.saveAndFlush(person);</span><br><span class="line"></span><br><span class="line">    System.out.println(person == person2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JpaSpecificationExecutor接口">JpaSpecificationExecutor接口</h3>
<ul>
<li>不属于Repository体系，实现一组 JPA Criteria 查询相关的方法</li>
<li>Specification：封装  JPA Criteria 查询条件。通常使用匿名内部类的方式来创建该接口的对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonRepsotory</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Person</span>, <span class="title">Integer</span>&gt;,<span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">Person</span>&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>实现带查询条件的分页</strong>(PagingAndSortingRespository接口做不到)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 目标: 实现带查询条件的分页. id &gt; 5 的条件</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* 调用 JpaSpecificationExecutor 的 Page&lt;T&gt; findAll(Specification&lt;T&gt; spec, Pageable pageable);</span></span><br><span class="line"><span class="comment">* Specification: 封装了 JPA Criteria 查询的查询条件</span></span><br><span class="line"><span class="comment">* Pageable: 封装了请求分页的信息: 例如 pageNo, pageSize, Sort</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJpaSpecificationExecutor</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> pageNo = <span class="number">3</span> - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> pageSize = <span class="number">5</span>;</span><br><span class="line">    PageRequest pageable = <span class="keyword">new</span> PageRequest(pageNo, pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通常使用 Specification 的匿名内部类</span></span><br><span class="line">    Specification&lt;Person&gt; specification = <span class="keyword">new</span> Specification&lt;Person&gt;() &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * <span class="doctag">@param</span> *root: 代表查询的实体类. </span></span><br><span class="line"><span class="comment">			 * <span class="doctag">@param</span> query: 可以从中可到 Root 对象, 即告知 JPA Criteria 查询要查询哪一个实体类. 还可以</span></span><br><span class="line"><span class="comment">			 * 来添加查询条件, 还可以结合 EntityManager 对象得到最终查询的 TypedQuery 对象. </span></span><br><span class="line"><span class="comment">			 * <span class="doctag">@param</span> *cb: CriteriaBuilder 对象. 用于创建 Criteria 相关对象的工厂. 当然可以从中获取到 Predicate 对象</span></span><br><span class="line"><span class="comment">			 * <span class="doctag">@return</span>: *Predicate 类型, 代表一个查询条件. </span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Person&gt; root,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">            Path path = root.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            Predicate predicate = cb.gt(path, <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">return</span> predicate;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Page&lt;Person&gt; page = personRepsotory.findAll(specification, pageable);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;总记录数: &quot;</span> + page.getTotalElements());</span><br><span class="line">    System.out.println(<span class="string">&quot;当前第几页: &quot;</span> + (page.getNumber() + <span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;总页数: &quot;</span> + page.getTotalPages());</span><br><span class="line">    System.out.println(<span class="string">&quot;当前页面的 List: &quot;</span> + page.getContent());</span><br><span class="line">    System.out.println(<span class="string">&quot;当前页面的记录数: &quot;</span> + page.getNumberOfElements());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Path path = root.get(“id”);</p>
</blockquote>
<p>上面这句代码参考下图理解：</p>
<p><img src="JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210626140727153.png" alt="image-20210626140727153"></p>
<h3 id="自定义Repository方法">自定义Repository方法</h3>
<ul>
<li>为某一个 Repository 上添加自定义方法
<ul>
<li>定义一个接口: 声明要添加的, 并自实现的方法</li>
<li>提供该接口的实现类: 类名需在要声明的 Repository 后添加 Impl, 并实现方法</li>
<li>声明 Repository 接口, 并继承 1) 声明的接口</li>
<li>使用.</li>
<li>注意: 默认情况下, Spring Data 会在 base-package 中查找 “接口名Impl” 作为实现类. 也可以通过　repository-impl-postfix　声明后缀.</li>
</ul>
</li>
</ul>
<p><img src="JPA-Spring-Data%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.assets/image-20210626141302329.png" alt="image-20210626141302329"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonDao</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonRepsotoryImpl</span> <span class="keyword">implements</span> <span class="title">PersonDao</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@PersistenceContext</span></span><br><span class="line">	<span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Person person = entityManager.find(Person.class, <span class="number">11</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;--&gt;&quot;</span> + person);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonRepsotory</span> <span class="keyword">extends</span> </span></span><br><span class="line"><span class="class">    <span class="title">JpaRepository</span>&lt;<span class="title">Person</span>, <span class="title">Integer</span>&gt;,</span></span><br><span class="line"><span class="class">	<span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">Person</span>&gt;, <span class="title">PersonDao</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCustomRepositoryMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">    personRepsotory.test();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/06/08/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%EF%BC%9A%E3%80%8A%E6%B4%BB%E4%B8%8B%E5%8E%BB%E7%9A%84%E7%90%86%E7%94%B1%E3%80%8B/" rel="prev" title="读书笔记：《活下去的理由》">
      <i class="fa fa-chevron-left"></i> 读书笔记：《活下去的理由》
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/07/18/Test-basis-md/" rel="next" title="Test basis.md">
      Test basis.md <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">JPA&amp;Spring Data笔记整理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#JPA"><span class="nav-text">JPA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-%E6%A6%82%E8%BF%B0"><span class="nav-text">JPA_概述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JPA-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-text">JPA 是什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JPA%E5%92%8CHibernate%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-text">JPA和Hibernate的关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JPA%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="nav-text">JPA的优势</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HelloWorld"><span class="nav-text">HelloWorld</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8JPA%E6%8C%81%E4%B9%85%E5%8C%96%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="nav-text">使用JPA持久化对象的步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E7%9B%B8%E5%85%B3"><span class="nav-text">代码相关</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-%E5%9F%BA%E6%9C%AC%E6%B3%A8%E8%A7%A3"><span class="nav-text">JPA 基本注解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Transient%E6%B3%A8%E8%A7%A3"><span class="nav-text">@Transient注解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Temporal"><span class="nav-text">**@**Temporal</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8-table-%E6%9D%A5%E7%94%9F%E6%88%90%E4%B8%BB%E9%94%AE%E8%AF%A6%E8%A7%A3"><span class="nav-text">用 table 来生成主键详解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-EntityManager-1"><span class="nav-text">JPA_EntityManager(1)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Persistence"><span class="nav-text">Persistence</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EntityManagerFactory"><span class="nav-text">EntityManagerFactory</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-EntityManager-2"><span class="nav-text">JPA_EntityManager(2)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#find%E6%96%B9%E6%B3%95"><span class="nav-text">find方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getReference%E6%96%B9%E6%B3%95"><span class="nav-text">getReference方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#persist%E6%96%B9%E6%B3%95"><span class="nav-text">persist方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#remove%E6%96%B9%E6%B3%95"><span class="nav-text">remove方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jpa%E8%A7%92%E5%BA%A6%E4%B8%8B%E5%AF%B9%E8%B1%A1%E5%88%86%E4%B8%BA%E5%9B%9B%E7%A7%8D%E7%8A%B6%E6%80%81"><span class="nav-text">jpa角度下对象分为四种状态</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-EntityManager-3-%E2%80%93merge%E6%96%B9%E6%B3%95"><span class="nav-text">JPA_EntityManager(3)–merge方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-EntityManager-4"><span class="nav-text">JPA_EntityManager(4)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#flush%E6%96%B9%E6%B3%95"><span class="nav-text">flush方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#refresh%E6%96%B9%E6%B3%95"><span class="nav-text">refresh方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#clear%E6%96%B9%E6%B3%95"><span class="nav-text">clear方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-EntityTransaction"><span class="nav-text">JPA_EntityTransaction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-%E6%98%A0%E5%B0%84%E5%8D%95%E5%90%91%E5%A4%9A%E5%AF%B9%E4%B8%80%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="nav-text">JPA_映射单向多对一的关联关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-%E6%98%A0%E5%B0%84%E5%8D%95%E5%90%91%E4%B8%80%E5%AF%B9%E5%A4%9A%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="nav-text">JPA_映射单向一对多的关联关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-%E6%98%A0%E5%B0%84%E5%8F%8C%E5%90%91%E4%B8%80%E5%AF%B9%E5%A4%9A%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="nav-text">JPA_映射双向一对多的关联关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-%E6%98%A0%E5%B0%84%E5%8F%8C%E5%90%91%E4%B8%80%E5%AF%B9%E4%B8%80%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="nav-text">JPA_映射双向一对一的关联关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-%E6%98%A0%E5%B0%84%E5%8F%8C%E5%90%91%E5%A4%9A%E5%AF%B9%E5%A4%9A%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="nav-text">JPA_映射双向多对多的关联关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="nav-text">JPA_二级缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-JPQL-HelloWorld"><span class="nav-text">JPA_JPQL_HelloWorld</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-JPQL-%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98"><span class="nav-text">JPA_JPQL_查询缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-JPQL-ORDERBY%E5%92%8CGROUPBY"><span class="nav-text">JPA_JPQL_ORDERBY和GROUPBY</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-JPQL-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2"><span class="nav-text">JPA_JPQL_关联查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPQL-%E5%AD%90%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0"><span class="nav-text">JPQL_子查询和内建函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-JPQL-DELETE%E5%92%8CUPDATE"><span class="nav-text">JPA_JPQL_DELETE和UPDATE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JPA-%E6%95%B4%E5%90%88Spring"><span class="nav-text">JPA_整合Spring</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-Data"><span class="nav-text">Spring Data</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-text">概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HelloWorld-2"><span class="nav-text">HelloWorld</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E6%B5%8B%E8%AF%95"><span class="nav-text">代码测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Repository%E6%8E%A5%E5%8F%A3"><span class="nav-text">Repository接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Repository%E6%9F%A5%E8%AF%A2%E6%96%B9%E6%B3%95%E5%AE%9A%E4%B9%89%E8%A7%84%E8%8C%83"><span class="nav-text">Repository查询方法定义规范</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Query%E6%B3%A8%E8%A7%A3"><span class="nav-text">Query注解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Modifying%E6%B3%A8%E8%A7%A3"><span class="nav-text">Modifying注解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CrudRepository%E6%8E%A5%E5%8F%A3"><span class="nav-text">CrudRepository接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PagingAndSortingRespository%E6%8E%A5%E5%8F%A3"><span class="nav-text">PagingAndSortingRespository接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JpaRepository%E6%8E%A5%E5%8F%A3"><span class="nav-text">JpaRepository接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JpaSpecificationExecutor%E6%8E%A5%E5%8F%A3"><span class="nav-text">JpaSpecificationExecutor接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Repository%E6%96%B9%E6%B3%95"><span class="nav-text">自定义Repository方法</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">daren bi</p>
  <div class="site-description" itemprop="description">真正牛逼的，不是那些可以随口拿来夸耀的事迹，而是那些在困境中依然保持微笑的凡人 --程浩</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">daren bi</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
